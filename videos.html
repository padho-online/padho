<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Onlibry | Free Educational Videos & Tutorials</title>
<meta name="description" content="Watch educational videos, tutorials, and lectures on various subjects for better learning.">
<link rel="canonical" href="https://onlibry.xyz/videos.html">

    <meta name="keywords" content="free books, past papers, study materials, Onlibry library, online education, Degree Books, Degree materials, Degree notes, University updates">
    <meta name="author" content="Onlibry">
    
    <!-- Open Graph for Facebook & WhatsApp -->
    <meta property="og:title" content="Onlibry | Free Digital Library">
    <meta property="og:description" content="Download books, past papers & more for free.">
    <meta property="og:image" content="https://onlibry.xyz/logo.png">
    <meta property="og:url" content="https://onlibry.xyz/">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card for better preview -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Onlibry | Free Educational Resources">
    <meta name="twitter:description" content="Get free books, past papers, and study materials.">
    <meta name="twitter:image" content="https://onlibry.xyz/logo.png">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" href="logo transparent.png">
    <script src="security.js"></script>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NH4N1LBHRQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NH4N1LBHRQ');
</script>
    <link rel="stylesheet" href="videos.css">
</head>
<body>
<header>
    <div class="logo"><a href="index.html" ><img src="logo transparent.png" alt="logo"></a></div>
    <nav class="nav">
        <a href="index.html">Home</a>
        <a href="books.html">Books</a>
        <a href="resources.html">Resources</a>
        <a href="papers.html">Papers</a>
        <a href="videos.html" class="active">Videos</a>
        <a href="feedback.html">Feedback</a>
    </nav>
</header>
<div class="search-bar">
    <input type="text" id="searchInput" placeholder="Search for videos...">
</div>
<main>
    <aside class="sidebar">
        <h2>Recently Watched</h2>
        <div id="recentlyWatched">
            <!-- Recently watched videos will be inserted here -->
        </div>
    </aside>
    <section class="content">
        <div class="video-player">
            <iframe id="videoPlayer" src="https://i.pinimg.com/736x/6d/64/7f/6d647ffade64c99588c3c0744855cfe4.jpg" title="video1" allowfullscreen></iframe>
        </div>
        <div class="all-videos">
            <h2>All Videos</h2>
            <div class="video-grid" id="allVideos">
                <!-- Dynamic video items will be inserted here -->
            </div>
            <div id="noResults" class="text-center mt-3">No videos found.</div>
        </div>
    </section>
</main>
<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwvlUO4I-6fk-fm0iascE1yoiYEi4Jzr-tUIwnjU7mMR4cggwJo4WsyTsI5srishWlRmg/exec";

    let videos = [];
    let cacheTime = localStorage.getItem("cacheTime");
    let cachedVideos = localStorage.getItem("cachedVideos");

    async function fetchVideos() {
        let currentTime = new Date().getTime();

        // Check if cached data exists and is within 1-minute limit
        if (cachedVideos && cacheTime && currentTime - cacheTime < 60000) {
            videos = JSON.parse(cachedVideos);
            console.log("Loaded from cache");
        } else {
            try {
                const response = await fetch(API_URL);
                videos = await response.json();
                localStorage.setItem("cachedVideos", JSON.stringify(videos));
                localStorage.setItem("cacheTime", currentTime);
                console.log("Fetched from API");
            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }

        renderVideoList(allVideosContainer, videos);
    }

    const searchInput = document.getElementById('searchInput');
    const videoPlayer = document.getElementById('videoPlayer');
    const allVideosContainer = document.getElementById('allVideos');
    const recentlyWatchedContainer = document.getElementById('recentlyWatched');
    const noResults = document.getElementById('noResults');

    function loadVideo(videoId, title) {
        videoPlayer.src = `https://www.youtube.com/embed/${videoId}`;
        const video = videos.find(v => v.id === videoId);
        if (video) {
            addRecentlyWatched(videoId, title, video.thumbnail);
        }
    }

    function addRecentlyWatched(videoId, title, thumbnail) {
        let recentlyWatchedVideos = JSON.parse(localStorage.getItem('recentlyWatched')) || [];
        recentlyWatchedVideos = recentlyWatchedVideos.filter(video => video.id !== videoId);
        recentlyWatchedVideos.unshift({ id: videoId, title, thumbnail });

        if (recentlyWatchedVideos.length > 5) {
            recentlyWatchedVideos = recentlyWatchedVideos.slice(0, 5);
        }

        localStorage.setItem('recentlyWatched', JSON.stringify(recentlyWatchedVideos));
        renderRecentlyWatched();
    }

    function renderVideoList(container, videoList) {
        container.innerHTML = '';
        if (videoList.length === 0) {
            noResults.style.display = 'block';
        } else {
            noResults.style.display = 'none';
            videoList.forEach(video => {
                const videoItem = document.createElement('div');
                videoItem.className = 'video-item';
                videoItem.style.backgroundImage = `url(${video.thumbnail})`;
                videoItem.innerHTML = `<div><p>${video.title}</p><p>${video.tags.join(", ")}</p></div>`;
                videoItem.addEventListener('click', () => loadVideo(video.id, video.title));
                container.appendChild(videoItem);
            });
        }
    }

    function renderRecentlyWatched() {
        const recentlyWatchedVideos = JSON.parse(localStorage.getItem('recentlyWatched')) || [];
        recentlyWatchedContainer.innerHTML = '';

        if (recentlyWatchedVideos.length === 0) {
            recentlyWatchedContainer.innerHTML = '<p>No recently watched videos.</p>';
        } else {
            recentlyWatchedVideos.forEach(video => {
                const videoItem = document.createElement('div');
                videoItem.className = 'video-item';
                videoItem.innerHTML = `<img src="${video.thumbnail}" alt="${video.title}"><p>${video.title}</p>`;
                videoItem.addEventListener('click', () => loadVideo(video.id, video.title));
                recentlyWatchedContainer.appendChild(videoItem);
            });
        }
    }

    searchInput.addEventListener('input', (event) => {
        const query = event.target.value.toLowerCase();
        const filteredVideos = videos.filter(video =>
            video.title.toLowerCase().includes(query) || video.tags.some(tag => tag.toLowerCase().includes(query))
        );
        renderVideoList(allVideosContainer, filteredVideos);
    });

    document.addEventListener('DOMContentLoaded', () => {
        fetchVideos();
        renderRecentlyWatched();
    });
</script>
<footer>
    <div class="fnav">
        <a href="about.html" class="fitem">About Us</a>
        <a href="privacy.html" class="fitem">Privacy Policy</a>
        <a href="contact.html" class="fitem">Contact Us</a>
      </div>
      <div class="fcopy">
        <p>&copy; 2025 Onlibry.xyz. All rights reserved.</p>
      </div>
</footer>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Onlibry | Free Books for Students</title>
    <meta name="description" content="Browse and download free educational books on Onlibry. Find textbooks, reference materials, and eBooks.">
    <meta name="keywords" content="free books, past papers, study materials, Onlibry library, online education, Degree Books, Degree materials, Degree notes, University updates">
    <meta name="author" content="Onlibry">
    <meta property="og:title" content="Onlibry | Free Digital Library">
    <meta property="og:description" content="Download books, past papers & more for free.">
    <meta property="og:image" content="https://onlibry.xyz/logo.png">
    <meta property="og:url" content="https://onlibry.xyz/">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Onlibry | Free Educational Resources">
    <meta name="twitter:description" content="Get free books, past papers, and study materials.">
    <meta name="twitter:image" content="https://onlibry.xyz/logo.png">
    <link rel="canonical" href="https://onlibry.xyz/books.html">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" type="image/png" href="logo transparent.png">
    <script src="security.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NH4N1LBHRQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NH4N1LBHRQ');
</script>
 <link rel="stylesheet" href="books.css">
</head>
<body>
    <header>
        <div class="logo">
            <a href="index.html" ><img src="logo transparent.png" alt="logo"></a>
            <span class="search-logo">üîç</span>
            <input type="text" class="search-input" placeholder="Search books...">
        </div>
        <nav class="navigation">
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="books.html" class="active">Books</a></li>
                <li><a href="resources.html">Resources</a></li>
                <li><a href="papers.html">Papers</a></li>
                <li><a href="videos.html">Videos</a></li>
                <li><a href="feedback.html">Feedback</a></li>
            </ul>
        </nav>
        <div class="search-results">
            <ul></ul>
        </div>
    </header>
    <main>
        <div class="container mt-3">
            <input type="text" id="searchBar" class="form-control" placeholder="Search by book name or author">
            <div class="filter-buttons text-center mt-3"></div>
            <div id="booksContainer" class="row mt-3"></div>
            <div id="noResults" class="text-center mt-3">No books found.</div>
        </div>
    </main>
    
<script>
        function getFileId(url) {
    let match = url.match(/\/d\/([a-zA-Z0-9_-]+)/);
    return match ? match[1] : null;
}

async function fetchBooks() {
    let cachedBooks = localStorage.getItem("booksData");
    let books = [];

    if (cachedBooks) {
        console.log("Loading books from cache...");
        books = JSON.parse(cachedBooks);
        renderBooks(books);
    }

    try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbx-TX-D3D-n9KaUOHvEDbBqMQVJEp2D-lq8bCuuD2HrnpBt-1WEWyhAkrnFopHc0d4uNw/exec");
        const freshBooks = await response.json();

        if (!cachedBooks || JSON.stringify(freshBooks) !== cachedBooks) {
            console.log("Fetching fresh books...");
            localStorage.setItem("booksData", JSON.stringify(freshBooks));
            renderBooks(freshBooks);
        }
    } catch (error) {
        console.error("Error fetching book data:", error);
    }
}

function renderBooks(filteredBooks) {
    const booksContainer = document.getElementById('booksContainer');
    const noResults = document.getElementById('noResults');
    booksContainer.innerHTML = '';

    if (filteredBooks.length === 0) {
        noResults.style.display = 'block';
    } else {
        noResults.style.display = 'none';
        filteredBooks.forEach(book => {
            const bookElement = document.createElement('div');
            bookElement.classList.add('col-md-4');

            // Google Drive File Handling
            let fileId = getFileId(book.link);
            let viewerLink = fileId ? `viewer.html?fileId=${fileId}` : book.link;

            bookElement.innerHTML = `
                <div class="book-card" style="background-image: url('${book.image}');">
                    <h4>${book.name}</h4>
                    <p> ${book.author}</p>
                    <p>${book.description}</p>
                    <button onclick="window.open('${viewerLink}', '_blank')">Read/Download</button>
                </div>
            `;
            booksContainer.appendChild(bookElement);
        });
    }
}
document.getElementById('searchBar').addEventListener('input', function () {
    const query = this.value.toLowerCase();
    let cachedBooks = localStorage.getItem("booksData");

    if (cachedBooks) {
        const books = JSON.parse(cachedBooks);
        const filteredBooks = books.filter(book => 
            book.name.toLowerCase().includes(query) || 
            book.author.toLowerCase().includes(query) ||
            book.description.toLowerCase().includes(query)
        );
        renderBooks(filteredBooks);
    }
});
fetchBooks();
    </script>
<footer>
    <div class="fnav">
        <a href="about.html" class="fitem">About Us</a>
        <a href="privacy.html" class="fitem">Privacy Policy</a>
        <a href="contact.html" class="fitem">Contact Us</a>
      </div>
      <div class="fcopy">
        <p>&copy; 2025 Onlibry.xyz. All rights reserved.</p>
      </div>
</footer>
</body>
</html>
